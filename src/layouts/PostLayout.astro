---
import '../styles/global.css';
import TableOfContents from '../components/TableOfContentsFixed.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    pubDate: Date | string;
    platform?: string;
    difficulty?: string;
    tags?: string[];
    cve?: string;
  };
  headings?: any[];
}

const { frontmatter, headings = [] } = Astro.props;

// Ensure pubDate is a Date object
const pubDate = frontmatter.pubDate instanceof Date 
  ? frontmatter.pubDate 
  : new Date(frontmatter.pubDate);
---

<html lang="en" class="scroll-smooth">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={frontmatter.description} />
    <title>{frontmatter.title} | Security Research</title>
</head>
<body class="bg-slate-950 text-slate-200 leading-relaxed">
    <!-- Header -->
    <header class="bg-slate-900 border-b border-slate-800 sticky top-0 z-40">
        <div class="max-w-5xl mx-auto px-6 py-3 text-sm">
            <a href="/" class="text-emerald-400 hover:text-emerald-300 transition-colors">
                ← back to research
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <article class="max-w-7xl mx-auto px-6 py-12">
        <!-- Post Metadata -->
        <header class="mb-12 border-b border-slate-800 pb-8">
            <div class="flex items-center gap-2 text-sm font-mono text-emerald-400 mb-3">
                <time datetime={pubDate.toISOString()}>
                    {pubDate.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit' 
                    })}
                </time>
                <span>•</span>
                {frontmatter.platform && <span>{frontmatter.platform}</span>}
                {frontmatter.difficulty && <span>•</span>}
                {frontmatter.difficulty && <span>{frontmatter.difficulty}</span>}
            </div>
            
            <h1 class="text-5xl font-bold text-slate-100 mb-4 leading-tight font-mono tracking-tight">
                {frontmatter.title}
            </h1>
            
            <p class="text-lg text-slate-400 font-light leading-relaxed">
                {frontmatter.description}
            </p>

            {/* Tags */}
            {frontmatter.tags && (
                <div class="flex flex-wrap gap-2 mt-6">
                    {frontmatter.tags.map((tag) => (
                        <span class="inline-block px-3 py-1 bg-slate-800 border border-slate-700 text-slate-300 text-xs font-mono rounded hover:bg-slate-700 transition-colors">
                            #{tag}
                        </span>
                    ))}
                </div>
            )}
        </header>

        <!-- Post Body with TOC Sidebar -->
        <div class="flex gap-8 relative">
            <!-- Main Content Column -->
            <main class="flex-1 min-w-0 prose prose-invert max-w-none prose-lg
                         prose-headings:font-mono prose-headings:font-bold prose-headings:tracking-tight
                         prose-h2:text-3xl prose-h2:mt-10 prose-h2:mb-4 prose-h2:text-slate-100 prose-h2:border-l-4 prose-h2:border-emerald-400 prose-h2:pl-4
                         prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3 prose-h3:text-slate-200
                         prose-h4:text-lg prose-h4:mt-4 prose-h4:mb-2 prose-h4:text-slate-300
                         prose-p:text-slate-300 prose-p:leading-relaxed
                         prose-code:text-emerald-300 prose-code:bg-slate-800 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono
                         prose-pre:bg-slate-800 prose-pre:border prose-pre:border-slate-700 prose-pre:text-slate-100 prose-pre:overflow-x-auto prose-pre:rounded
                         prose-pre:p-4 prose-pre:text-sm prose-pre:leading-relaxed
                         prose-a:text-blue-400 hover:prose-a:text-blue-300 prose-a:underline prose-a:transition-colors
                         prose-strong:text-slate-100 prose-strong:font-semibold
                         prose-em:text-slate-300 prose-em:italic
                         prose-blockquote:border-l-4 prose-blockquote:border-slate-600 prose-blockquote:pl-4 prose-blockquote:text-slate-400 prose-blockquote:italic
                         prose-table:text-slate-300
                         prose-thead:text-slate-200 prose-thead:font-mono prose-thead:bg-slate-800 prose-thead:border-slate-700
                         prose-td:border-slate-700 prose-td:px-4 prose-td:py-2
                         prose-th:text-left prose-th:px-4 prose-th:py-2 prose-th:font-mono prose-th:text-sm
                         prose-tbody:divide-y prose-tbody:divide-slate-700
                         prose-tr:border-slate-700
                         prose-hr:border-slate-700 prose-hr:my-8
                         prose-ol:text-slate-300
                         prose-ul:text-slate-300
                         prose-li:text-slate-300">
                <slot />
            </main>

            <!-- Table of Contents Sidebar -->
            {headings && headings.length > 0 && (
                <aside class="hidden lg:block w-64 flex-shrink-0">
                    <TableOfContents headings={headings} />
                </aside>
            )}
        </div>
    </article>

    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800 mt-16">
        <div class="max-w-4xl mx-auto px-6 py-8 text-center text-slate-500 text-sm font-mono">
            <p>© 2025 Security Research | GIKI</p>
        </div>
    </footer>

    <style>
        /* Ensure code blocks don't cause layout shift */
        pre {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Syntax highlighting for code blocks (via Shiki) */
        pre code {
            display: block;
            width: 100%;
        }

        /* Improve table readability */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        tbody tr:hover {
            background-color: rgba(15, 23, 42, 0.5);
        }

        /* Mobile responsiveness */
        @media (max-width: 640px) {
            article {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            h1 {
                font-size: 2rem !important;
            }

            pre {
                font-size: 0.75rem;
            }

            table {
                font-size: 0.875rem;
            }
        }
    </style>
</body>
</html>